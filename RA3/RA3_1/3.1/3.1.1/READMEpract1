Práctica 1: Hardening de Servidor Apache con Docker

Este proyecto consiste en la creación de un entorno web seguro utilizando Apache dentro de un contenedor Docker. Se han aplicado técnicas de endurecimiento (hardening) para minimizar la superficie de exposición y mejorar la seguridad de las comunicaciones.
Estructura del Proyecto

Los archivos se encuentran en un disco externo para mantener el sistema anfitrión limpio:

    Dockerfile: Receta para construir la imagen segura.

    hardened.conf: Configuraciones específicas de seguridad (Ocultación de firmas, CSP, HSTS).

    default-ssl.conf: Configuración del VirtualHost para el puerto seguro (443).

    server.crt y server.key: Certificados SSL (Self-signed).

Mejoras de Seguridad Aplicadas (Hardening)

    Ocultación de Identidad: Se han configurado las directivas ServerTokens ProductOnly y ServerSignature Off para evitar que el servidor revele su versión y sistema operativo en las cabeceras HTTP.

    Deshabilitación de Módulos Inseguros: Se ha desactivado el módulo mod_autoindex para evitar que se listen los archivos de los directorios de forma automática.

    HTTP Strict Transport Security (HSTS): Se ha implementado la cabecera Strict-Transport-Security para obligar a los navegadores a comunicarse únicamente mediante HTTPS durante un periodo de 2 años.

    Content Security Policy (CSP): Se ha establecido una política default-src 'self' para prevenir ataques de Cross-Site Scripting (XSS) e inyección de datos, permitiendo solo contenido del propio origen.

    Comunicaciones Cifradas (SSL/TLS): Configuración de un entorno seguro en el puerto 443 utilizando certificados SSL.

Instrucciones de Despliegue
1. Generación de Certificados
Bash

openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout server.key -out server.crt -subj "/C=ES/ST=ST/L=L/O=O/OU=OU/CN=localhost"

2. Construcción de la Imagen

Desde la carpeta de la práctica en el disco externo:
Bash

sudo docker build -t apache-harden-ssl .

3. Ejecución del Contenedor

Mapeo de puertos: Puerto 8080 para tráfico HTTP y puerto 8081 para tráfico seguro HTTPS.
Bash

sudo docker run -d \
  -p 8080:80 \
  -p 8081:443 \
  --name servidor_hardening \
  apache-harden-ssl

Verificación de Resultados

Para comprobar que las directivas de seguridad están activas, se pueden realizar las siguientes consultas:

    Verificación HTTP (Puerto 8080):
    Bash

curl -I http://localhost:8080

Verificación HTTPS (Puerto 8081):
Bash

    curl -I -k https://localhost:8081

En la respuesta se debe observar la ausencia de la versión de Apache y la presencia de las cabeceras Strict-Transport-Security y Content-Security-Policy.
